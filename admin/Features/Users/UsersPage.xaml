<Page x:Class="admin.Features.Users.UsersPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    xmlns:local="clr-namespace:admin.Features.Users"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d" 
    >
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <ui:Card
            Grid.Column="0"
            Margin="10,10,10,10"
            Width="300"
            VerticalAlignment="Top"
            >
            <StackPanel>
                <Ellipse
                    Width="200"
                    Height="200"
                    Margin="10,30,10,10"
                    >
                    <Ellipse.Fill>
                        <ImageBrush
                            ImageSource="{Binding UserAvatar}"
                            Stretch="UniformToFill"
                        />
                    </Ellipse.Fill>
                </Ellipse>
                <TextBlock
                    Text="{Binding Username}"
                    Foreground="{DynamicResource AccentTextFillColorSecondaryBrush}"
                    FontSize="22"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,5"
                />
                <TextBlock
                    Text="{Binding UserDisplayName}"
                    FontSize="14"
                    Visibility="{Binding UserDisplayName, Converter={StaticResource NullToVisibilityConverter}}"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,5"
                />
            </StackPanel>
        </ui:Card>
        <!--<controls:ProfileCard
            Grid.Column="0"
            Avatar="{Binding UserAvatar}"
            DisplayName="{Binding UserDisplayName}"
            Username="{Binding Username}"
            UserRole=""
        />-->
        <StackPanel
            Grid.Column="1"
            >
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <Label
                        Content="Введите имя пользователя"
                        Margin="8 8 8 0"
                        Foreground="{StaticResource AccentTextFillColorPrimaryBrush }"
                    />
                    <ui:TextBox 
                        MinWidth="200"
                        Margin="8 0 8 8"
                        Text="{Binding SearchUsername, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    />
                </StackPanel>
                <ui:Button
                    Appearance="Primary"
                    Grid.Column="1"
                    Content="Найти"
                    Command="{Binding SearchCommand}"
                    Margin="8,24,50,0"
                    Width="100"
                />
            </Grid>
            <hc:Pagination
                PageIndex="{Binding CurrentPage}"
                MaxPageCount="{Binding TotalPages}"
                >
                <hc:Interaction.Triggers>
                    <hc:EventTrigger EventName="PageUpdated">
                        <hc:EventToCommand Command="{Binding PageUpdatedCommand}" PassEventArgsToCommand="True" />
                    </hc:EventTrigger>
                </hc:Interaction.Triggers>
            </hc:Pagination>
            <DataGrid
                Grid.Column="1"
                Margin="10,10,10,10"
                HorizontalAlignment="Stretch"
                HeadersVisibility="All"
                RowHeaderWidth="60"
                AutoGenerateColumns="False"
                hc:DataGridAttach.ShowRowNumber="True"
                ItemsSource="{Binding Users, Mode=OneWay}"
                CanUserDeleteRows="False"
                CanUserAddRows="False"
                SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                SelectionMode="Single"
                >
                <DataGrid.Columns>
                    <DataGridTemplateColumn
                        Width="60"
                        CanUserResize="False"
                        >
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse
                                    Width="32"
                                    Height="32"
                                    >
                                    <Ellipse.Fill>
                                        <ImageBrush
                                            ImageSource="{Binding Avatar, Mode=OneWay}"
                                            Stretch="UniformToFill"
                                        />
                                    </Ellipse.Fill>
                                </Ellipse>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        Binding="{Binding Username, Mode=OneWay}"
                        CanUserResize="False"
                        Header="Никнейм"
                    />
                    <DataGridTextColumn
                        Binding="{Binding DisplayName, Mode=OneWay}"
                        CanUserResize="False"
                        Header="Отображаемое имя"
                    />
                    <DataGridTextColumn
                        Binding="{Binding LastOnline, Mode=OneWay}"
                        CanUserResize="False"
                        Header="Онлайн"
                    />
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
    </Grid>
</Page>
